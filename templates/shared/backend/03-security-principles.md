# セキュリティ原則

## 認証・認可設計

### 認証（Authentication）
#### 多要素認証（MFA）
- **何かを知っている**: パスワード・PIN
- **何かを持っている**: スマートフォン・トークン
- **何かである**: 生体認証・指紋

#### パスワードセキュリティ
- **強度要件**: 最小8文字・大小英数字記号混在
- **ハッシュ化**: bcrypt・Argon2・PBKDF2
- **ソルト**: レインボーテーブル攻撃対策
- **履歴管理**: 過去パスワードの再利用防止

#### セッション管理
- **セッションID**: 十分な長さ・ランダム性
- **有効期限**: 適切なタイムアウト設定
- **再生成**: ログイン時のID更新
- **無効化**: ログアウト時の完全削除

### 認可（Authorization）
#### アクセス制御モデル
- **RBAC**: Role-Based Access Control
- **ABAC**: Attribute-Based Access Control
- **PBAC**: Policy-Based Access Control
- **最小権限の原則**: 必要最小限のアクセス権のみ

#### 権限管理
- **階層構造**: 役割の継承関係
- **動的権限**: 実行時の権限決定
- **時間制限**: 期間限定アクセス
- **地理的制限**: 場所に基づく制御

## トークンベース認証

### JWT（JSON Web Token）
#### 構造
```
Header.Payload.Signature
```

#### ベストプラクティス
- **短い有効期限**: 15-30分程度
- **リフレッシュトークン**: 長期認証の仕組み
- **適切なアルゴリズム**: HS256・RS256・ES256
- **クレーム検証**: iss・aud・exp・nbfの確認

#### セキュリティ考慮事項
- **シークレット管理**: 強力な署名キー
- **None攻撃対策**: アルゴリズム検証
- **トークン盗取対策**: HTTPS必須・XSS対策

### OAuth 2.0
#### フロー種類
- **Authorization Code**: Webアプリケーション
- **Implicit**: SPAアプリケーション（非推奨）
- **Client Credentials**: サービス間通信
- **Device Code**: IoTデバイス

#### セキュリティ拡張
- **PKCE**: Code Challenge・Code Verifier
- **State パラメータ**: CSRF攻撃対策
- **Nonce**: リプレイ攻撃対策

## 暗号化

### データ暗号化
#### 保存時暗号化（Encryption at Rest）
- **データベース暗号化**: TDE・フィールドレベル暗号化
- **ファイル暗号化**: ファイルシステムレベル
- **バックアップ暗号化**: バックアップデータの保護

#### 転送時暗号化（Encryption in Transit）
- **TLS/HTTPS**: 通信経路の暗号化
- **相互認証**: クライアント証明書
- **証明書管理**: 自動更新・監視

### 暗号アルゴリズム
#### 対称暗号
- **AES-256**: 高速・強固な暗号化
- **ChaCha20-Poly1305**: モバイル最適化
- **キー管理**: 定期的なローテーション

#### 非対称暗号
- **RSA-2048/4096**: デジタル署名・鍵交換
- **ECDSA**: 楕円曲線暗号・効率的
- **Ed25519**: 高速・小さい鍵サイズ

#### ハッシュ関数
- **SHA-256/512**: デジタル署名・整合性検証
- **BLAKE2**: 高速ハッシュ
- **避けるべき**: MD5・SHA-1

## 入力検証・サニタイゼーション

### バリデーション原則
#### ホワイトリスト方式
- **許可リスト**: 受け入れ可能な値のみ許可
- **型検証**: 厳密なデータ型チェック
- **長さ制限**: 最大・最小文字数制御
- **文字セット**: 許可文字の明確化

#### サニタイゼーション
- **エスケープ処理**: 特殊文字の無害化
- **HTMLエンコード**: XSS攻撃対策
- **SQLエスケープ**: SQLインジェクション対策
- **コマンドインジェクション**: シェルコマンド対策

### 攻撃対策
#### インジェクション攻撃
- **SQLインジェクション**: パラメータ化クエリ・ORM使用
- **NoSQLインジェクション**: 型安全なクエリ構築
- **コマンドインジェクション**: 外部コマンド実行の制限
- **LDAPインジェクション**: エスケープ処理

#### XSS（Cross-Site Scripting）
- **Stored XSS**: 保存データの検証・エスケープ
- **Reflected XSS**: 入力値の適切な処理
- **DOM-based XSS**: クライアント側検証
- **CSP**: Content Security Policy設定

#### CSRF（Cross-Site Request Forgery）
- **CSRFトークン**: 一意なトークン検証
- **SameSite Cookie**: クロスサイト送信制御
- **リファラー検証**: 送信元ドメイン確認

## セキュリティヘッダー

### HTTP セキュリティヘッダー
```http
# XSS Protection
X-XSS-Protection: 1; mode=block
X-Content-Type-Options: nosniff
X-Frame-Options: DENY

# HTTPS Enforcement
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload

# Content Security Policy
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'

# Permission Policy
Permissions-Policy: geolocation=(), microphone=(), camera=()

# Referrer Policy
Referrer-Policy: strict-origin-when-cross-origin
```

### CORS（Cross-Origin Resource Sharing）
```http
Access-Control-Allow-Origin: https://trusted-domain.com
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type, Authorization
Access-Control-Allow-Credentials: true
Access-Control-Max-Age: 86400
```

## レート制限・DDoS対策

### レート制限戦略
#### 制限タイプ
- **IP単位**: 送信元IPアドレス
- **ユーザー単位**: 認証済みユーザー
- **API単位**: エンドポイント別制限
- **グローバル**: システム全体制限

#### アルゴリズム
- **Fixed Window**: 固定時間窓での制限
- **Sliding Window**: 移動時間窓での制限
- **Token Bucket**: トークンバケット方式
- **Leaky Bucket**: リーキーバケット方式

### DDoS対策
#### 検知・軽減
- **異常トラフィック検知**: パターン分析
- **ジオブロッキング**: 地域別アクセス制御
- **CDN活用**: 分散負荷軽減
- **オートスケーリング**: 動的リソース拡張

## セキュリティ監視・ログ

### セキュリティログ
#### ログ記録項目
- **認証試行**: 成功・失敗・異常パターン
- **権限変更**: 役割・権限の変更履歴
- **データアクセス**: 機密データアクセス記録
- **システム変更**: 設定変更・管理操作

#### ログ分析
- **異常検知**: 通常パターンからの逸脱
- **相関分析**: 複数イベントの関連性
- **脅威インテリジェンス**: 既知の攻撃パターン
- **リアルタイム監視**: 即座の対応トリガー

### インシデント対応
#### 対応フロー
1. **検知**: セキュリティイベントの発見
2. **分析**: 影響範囲・原因の調査
3. **封じ込め**: 被害拡大の防止
4. **根絶**: 脅威の完全除去
5. **復旧**: 正常運用の回復
6. **学習**: 再発防止策の実装

## プライバシー・コンプライアンス

### データ保護規制
#### GDPR（General Data Protection Regulation）
- **同意管理**: 明示的な同意取得
- **データポータビリティ**: データ移行権
- **削除権**: 忘れられる権利
- **影響評価**: プライバシー影響評価

#### 個人情報保護法
- **適正取得**: 正当な方法での収集
- **利用目的**: 明確な目的の明示
- **第三者提供**: 同意・委託の適切な管理
- **安全管理**: 技術的・物理的保護措置

### データ分類・管理
#### 分類レベル
- **パブリック**: 公開可能な情報
- **インターナル**: 内部利用情報
- **コンフィデンシャル**: 機密情報
- **リストリクテッド**: 極秘情報

#### 管理要件
- **暗号化**: レベル別暗号化要件
- **アクセス制御**: 最小権限原則
- **保存期間**: データ保持ポリシー
- **廃棄**: 安全な削除方法

## セキュリティテスト

### 脆弱性評価
#### 静的解析（SAST）
- **コード検査**: ソースコードの脆弱性検出
- **依存関係**: サードパーティライブラリ
- **設定ファイル**: セキュリティ設定の確認

#### 動的解析（DAST）
- **ランタイム検査**: 実行時の脆弱性検出
- **ファジング**: 異常入力による検査
- **ペネトレーションテスト**: 実際の攻撃シミュレーション

### セキュリティ開発ライフサイクル
#### DevSecOps
- **シフトレフト**: 開発初期でのセキュリティ組み込み
- **自動化**: セキュリティテストの CI/CD 統合
- **継続監視**: 運用中のセキュリティ監視

---

**言語固有の実装パターンは以下を参照：**
- [Go実装パターン](./go/)
- [TypeScript実装パターン](./typescript/)